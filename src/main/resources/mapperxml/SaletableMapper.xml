<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stock.mapper.SaletableMapper">
  <resultMap id="BaseResultMap" type="com.stock.domain.Saletable">
    <!--@mbg.generated generated on Tue Aug 27 16:01:01 CST 2019.-->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="commodityid" jdbcType="INTEGER" property="commodityid" />
    <result column="salenum" jdbcType="INTEGER" property="salenum" />
    <result column="locknum" jdbcType="INTEGER" property="locknum" />
    <result column="saleednum" jdbcType="INTEGER" property="saleednum" />
    <result column="activitynum" jdbcType="INTEGER" property="activitynum" />
    <result column="presellnum" jdbcType="INTEGER" property="presellnum" />
    <result column="merchantid" jdbcType="INTEGER" property="merchantid" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated generated on Tue Aug 27 16:01:01 CST 2019.-->
    id, commodityid, salenum, locknum, saleednum, activitynum, presellnum, merchantid
  </sql>
  <update id="addActivityNum">
    update saletable set activitynum=activitynum+#{param3},salenum=salenum-#{param3}
    where  merchantid=#{param1} and commodityid=#{param2}
  </update>

  <!--  付款成功后，修改可销售库存-，锁定库存-，已销售库存+-->
  <update id="payment" parameterType="java.util.List">
    <!-- 接收list参数，循环着组装sql语句，注意for循环的写法
            separator=";" 代表着每次循环完，在sql后面放一个分号
            item="params" 循环List的每条的结果集
            collection="list" list 即为 map传过来的参数key -->
    <foreach collection="list" separator=";" item="params">
      update saletable set
      salenum=salenum-#{params.num},
      locknum=locknum-#{params.num},
      saleednum=saleednum+#{params.num}
      WHERE commodityid=#{params.commodityid} and merchantid=#{params.merchantid}
    </foreach>
  </update>

  <!--  修改预售数量 -->
  <update id="addSaleNum" parameterType="java.util.List">
    <!-- 接收list参数，循环着组装sql语句，注意for循环的写法
                separator=";" 代表着每次循环完，在sql后面放一个分号
                item="params" 循环List的每条的结果集
                collection="list" list 即为 map传过来的参数key -->
    <foreach collection ="list" item="item" index= "index" separator=";">
      update saletable
      <set>
        presellnum = #{item.presellnum}
      </set>
      <where>
        commodityid =#{item.commodityid} and
        merchantid=#{item.merchantid}
      </where>
    </foreach>

  </update>

  <update id="cancelOrder" parameterType="java.util.List">

   <foreach collection="list" item="v" index="index" separator=";">
       update saletable
      <set>
              salenum=salenum+#{v.num},
              locknum=locknum-#{v.num}

      </set>
       where commodityid=#{v.commodityid} and merchantid=#{v.merchantid}
   </foreach>
  </update>

</mapper>